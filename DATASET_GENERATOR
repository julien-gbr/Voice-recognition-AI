# This is the process to record the sentences in order to create the dataset

import sounddevice as sd
from spicy.io.wavfile import write
import os
from pynput import keyboard

command_sentences = [ 
                  "lance google",
                  "lance spotify",
                  "ferme google",
                  "Ã©teins l'ordinateur",
                  "ouvre le terminal"
]

directory = "path de mon dossier"
if not os.path.exists(directory):
    os.makedirs(directory)

while True:
  try:
      number_of_repetitions = int(input("Enter the number of time you want to repeat the word"))
      if number_of_repetitions <= 0:
          print("Only positif number allowed")
          continue
      break
  except ValueError:
      print("Only number")

def record_sentence():
    print("Press Space to stop the record")
    recording = []
    stream = sd.InputStream(samplerate=fs, channels=1, dtype='int16')

    def on_press(key):
        if key == keyboard.Key.space:
            stream.stop()
            return False

    with stream:
        stream.start()
        listener = keyboard.Listener(on_press=on_press)
        listener.start()
        while stream.active:
            frame, _ = stream.read(1024)
            recording.append(frame.copy())
    return b''.join(recording)

for idx, phrase in enumerate(phrases):
    for rep in range(number_of_repetitions):
        print(f"\nYou need to repeat the sentence : '{phrase}' (Repetitions {rep + 1}/{number_of_repetitions})")
        input("Press Enter to record")
        print("Speak now")

        audio_data = record_sentence()

        print("Record ended")

        filemane = f"{idx}_{rep}_{phrase.replace(' ', '_')}.wav"
        filepath = os.path.join(directory, filename)

        write(filepath, fs, audio_data)
        print(f'File save with the name: {filepath}")

print("\nFinish")
